# TSN (Time-Sensitive Networking) ì™„ë²½ ê°€ì´ë“œ

## ğŸ“š ëª©ì°¨
1. [TSNì´ë€ ë¬´ì—‡ì¸ê°€?](#tsnì´ë€-ë¬´ì—‡ì¸ê°€)
2. [ì™œ TSNì´ í•„ìš”í•œê°€?](#ì™œ-tsnì´-í•„ìš”í•œê°€)
3. [CBS (Credit-Based Shaper) ìƒì„¸ ì„¤ëª…](#cbs-credit-based-shaper-ìƒì„¸-ì„¤ëª…)
4. [TAS (Time-Aware Shaper) ìƒì„¸ ì„¤ëª…](#tas-time-aware-shaper-ìƒì„¸-ì„¤ëª…)
5. [Gate Control ë©”ì»¤ë‹ˆì¦˜](#gate-control-ë©”ì»¤ë‹ˆì¦˜)
6. [ì‹¤ì œ êµ¬í˜„ ë° ê²€ì¦](#ì‹¤ì œ-êµ¬í˜„-ë°-ê²€ì¦)

---

## TSNì´ë€ ë¬´ì—‡ì¸ê°€?

### ì •ì˜
TSN (Time-Sensitive Networking)ì€ í‘œì¤€ ì´ë”ë„·ì„ í†µí•´ **ê²°ì •ì (deterministic)** í†µì‹ ì„ ì œê³µí•˜ëŠ” IEEE 802.1 í‘œì¤€ ëª¨ìŒì…ë‹ˆë‹¤.

### í•µì‹¬ ê°œë…
- **ê²°ì •ì„±**: íŒ¨í‚·ì´ ì–¸ì œ ë„ì°©í• ì§€ ì •í™•íˆ ì˜ˆì¸¡ ê°€ëŠ¥
- **ë‚®ì€ ì§€ì—°ì‹œê°„**: ë§ˆì´í¬ë¡œì´ˆ ë‹¨ìœ„ì˜ ì§€ì—° ë³´ì¥
- **ë†’ì€ ì‹ ë¢°ì„±**: íŒ¨í‚· ì†ì‹¤ ìµœì†Œí™”
- **ì‹œê°„ ë™ê¸°í™”**: ëª¨ë“  ë…¸ë“œê°€ ë™ì¼í•œ ì‹œê°„ ê¸°ì¤€ ì‚¬ìš©

### ì£¼ìš” í‘œì¤€
| í‘œì¤€ | ì´ë¦„ | ê¸°ëŠ¥ |
|------|------|------|
| IEEE 802.1AS | Time Synchronization | PTP ê¸°ë°˜ ì‹œê°„ ë™ê¸°í™” |
| IEEE 802.1Qav | CBS | ëŒ€ì—­í­ ì˜ˆì•½ ë° ì œì–´ |
| IEEE 802.1Qbv | TAS | ì‹œê°„ ê¸°ë°˜ ê²Œì´íŠ¸ ì œì–´ |
| IEEE 802.1CB | FRER | í”„ë ˆì„ ë³µì œ ë° ì œê±° |
| IEEE 802.1Qbu | Frame Preemption | í”„ë ˆì„ ì„ ì  |

---

## ì™œ TSNì´ í•„ìš”í•œê°€?

### ê¸°ì¡´ ì´ë”ë„·ì˜ í•œê³„

#### 1. Best-Effort ì „ì†¡
```
ê¸°ì¡´ ì´ë”ë„·:
[High Priority] â”€â”€â”€â”€â”
[Low Priority]  â”€â”€â”€â”€â”¼â”€â”€â†’ [?????] â†’ ì–¸ì œ ë„ì°©í• ì§€ ëª¨ë¦„
[Critical Data] â”€â”€â”€â”€â”˜
```

#### 2. ìš°ì„ ìˆœìœ„ ì—­ì „ ë¬¸ì œ
```
í° íŒ¨í‚·ì´ ì „ì†¡ ì¤‘ì¼ ë•Œ:
[Large Low Priority Packet â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] ì „ì†¡ ì¤‘
[Urgent High Priority] â† ëŒ€ê¸°í•´ì•¼ í•¨ (ì°¨ë‹¨ë¨)
```

### TSNì´ í•´ê²°í•˜ëŠ” ë¬¸ì œ

#### 1. ê²°ì •ì  ì „ì†¡
```
TSN ë„¤íŠ¸ì›Œí¬:
[High Priority] â”€â”€â†’ [2ms Â± 0.1ms] â†’ ì •í™•í•œ ë„ì°© ì‹œê°„
[Low Priority]  â”€â”€â†’ [5ms Â± 0.2ms] â†’ ì˜ˆì¸¡ ê°€ëŠ¥
[Critical Data] â”€â”€â†’ [1ms Â± 0.05ms] â†’ ë³´ì¥ë¨
```

#### 2. íŠ¸ë˜í”½ ê²©ë¦¬
```
ì‹œê°„ ìŠ¬ë¡¯ í• ë‹¹:
ì‹œê°„: 0ms   50ms  100ms 150ms 200ms
TC0:  [â–ˆâ–ˆâ–ˆâ–ˆ]
TC1:        [â–ˆâ–ˆâ–ˆ]
TC2:              [â–ˆâ–ˆ]
TC3:                   [â–ˆâ–ˆ]
â†’ ê° TCê°€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘
```

---

## CBS (Credit-Based Shaper) ìƒì„¸ ì„¤ëª…

### ê°œë…
CBSëŠ” **ì‹ ìš©(credit)** ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ì—­í­ì„ ì œì–´í•©ë‹ˆë‹¤.

### ë™ì‘ ì›ë¦¬

#### Credit ë©”ì»¤ë‹ˆì¦˜
```
Credit ë³€í™”:
    â†‘
    â”‚     /idle-slope (credit ì¦ê°€)
    â”‚    /
    â”‚   /
Hi â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hi-Credit (ìµœëŒ€ê°’)
    â”‚ /
    â”‚/
 0 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚\
    â”‚ \
    â”‚  \send-slope (credit ê°ì†Œ)
Lo â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Lo-Credit (ìµœì†Œê°’)
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ì‹œê°„
```

#### ì „ì†¡ ê·œì¹™
1. **Credit > 0**: íŒ¨í‚· ì „ì†¡ ê°€ëŠ¥
2. **Credit â‰¤ 0**: íŒ¨í‚· ì „ì†¡ ë¶ˆê°€ (ëŒ€ê¸°)
3. **ì „ì†¡ ì¤‘**: Creditì´ send-slope ì†ë„ë¡œ ê°ì†Œ
4. **ëŒ€ê¸° ì¤‘**: Creditì´ idle-slope ì†ë„ë¡œ ì¦ê°€

### CBS ì„¤ì • ì˜ˆì‹œ

#### TC2 ì„¤ì • (1.5 Mbps ì œí•œ)
```python
# Credit íŒŒë¼ë¯¸í„° ê³„ì‚°
link_speed = 100  # Mbps
reserved_bw = 1.5  # Mbps

idle_slope = reserved_bw * 1000  # 1500 kbps
send_slope = -(link_speed - reserved_bw) * 1000  # -98500 kbps

# ìµœëŒ€ í”„ë ˆì„ í¬ê¸° ê¸°ì¤€
max_frame_size = 1522  # bytes
hi_credit = max_frame_size * 8  # bits
lo_credit = -hi_credit
```

### Priority Mapping ì´í•´

#### PCP â†’ Priority â†’ TC ë§¤í•‘
```
ì‚¬ìš©ì íŠ¸ë˜í”½ â†’ PCP íƒœê¹… â†’ Priority ê²°ì • â†’ TC í• ë‹¹ â†’ CBS ì ìš©

ì˜ˆì‹œ:
VoIP (PCP=4) â†’ Priority 2 â†’ TC2 â†’ 1.5 Mbps ì œí•œ
Video (PCP=0) â†’ Priority 6 â†’ TC6 â†’ 3.5 Mbps ì œí•œ
```

---

## TAS (Time-Aware Shaper) ìƒì„¸ ì„¤ëª…

### ê°œë…
TASëŠ” **ì‹œê°„ ê¸°ë°˜ ê²Œì´íŠ¸**ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° TCì˜ ì „ì†¡ ì‹œê°„ì„ ì œì–´í•©ë‹ˆë‹¤.

### Gate Control List (GCL)

#### 200ms ì‚¬ì´í´ ì˜ˆì‹œ
```
ì‚¬ì´í´: |â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 200ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’|

TC0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                         50ms (25%)
TC1:                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                  30ms (15%)
TC2:                         â–ˆâ–ˆâ–ˆâ–ˆ              20ms (10%)
TC3:                             â–ˆâ–ˆâ–ˆâ–ˆ          20ms (10%)
TC4:                                 â–ˆâ–ˆâ–ˆâ–ˆ      20ms (10%)
TC5:                                     â–ˆâ–ˆâ–ˆâ–ˆ  20ms (10%)
TC6:                                         â–ˆâ–ˆâ–ˆâ–ˆ 20ms (10%)
TC7:                                             â–ˆâ–ˆâ–ˆâ–ˆ 20ms (10%)

ì‹œê°„: 0   50  80  100 120 140 160 180 200ms
```

### Gate State ë¹„íŠ¸ë§ˆìŠ¤í¬

#### 8ë¹„íŠ¸ ê²Œì´íŠ¸ ìƒíƒœ
```
Gate State: 0b10000000 (0x80)
            â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚
            â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â†’ TC0 (0=ë‹«í˜, 1=ì—´ë¦¼)
            â”‚â”‚â”‚â”‚â”‚â”‚â”‚â†’â”€ TC1
            â”‚â”‚â”‚â”‚â”‚â”‚â†’â”€â”€ TC2
            â”‚â”‚â”‚â”‚â”‚â†’â”€â”€â”€ TC3
            â”‚â”‚â”‚â”‚â†’â”€â”€â”€â”€ TC4
            â”‚â”‚â”‚â†’â”€â”€â”€â”€â”€ TC5
            â”‚â”‚â†’â”€â”€â”€â”€â”€â”€ TC6
            â”‚â†’â”€â”€â”€â”€â”€â”€â”€ TC7

ì˜ˆì‹œ:
0x01 = 0b00000001 â†’ TC0ë§Œ ì—´ë¦¼
0x80 = 0b10000000 â†’ TC7ë§Œ ì—´ë¦¼
0xFF = 0b11111111 â†’ ëª¨ë“  TC ì—´ë¦¼
```

### ì™œ Gate Controlì´ í•„ìš”í•œê°€?

#### 1. ê°„ì„­ ë°©ì§€
```
Gate ì—†ì´:
TC0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (ê³„ì† ì „ì†¡)
TC1: ??? (ì–¸ì œ ì „ì†¡ ê°€ëŠ¥?)

Gate ìˆì„ ë•Œ:
TC0: â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ (ì •í•´ì§„ ì‹œê°„ë§Œ)
TC1:     â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ     (ìì‹ ì˜ ì‹œê°„ì—)
```

#### 2. ìµœëŒ€ ì§€ì—° ë³´ì¥
```
ìµœì•…ì˜ ê²½ìš° ì§€ì—° = ì‚¬ì´í´ ì‹œê°„ - ìì‹ ì˜ ìŠ¬ë¡¯ ì‹œê°„
TC0: ìµœëŒ€ 150ms ëŒ€ê¸° (200ms - 50ms)
TC7: ìµœëŒ€ 180ms ëŒ€ê¸° (200ms - 20ms)
```

---

## Gate Control ë©”ì»¤ë‹ˆì¦˜

### Gate ì „í™˜ ê³¼ì •

#### 1. Gate Open ì‹œí€€ìŠ¤
```
ì‹œê°„: T-1ms         T           T+1ms
ìƒíƒœ: [Closed] â†’ [Opening] â†’ [Open]
      íŒ¨í‚· ì°¨ë‹¨    ë²„í¼ ì¤€ë¹„    ì „ì†¡ ì‹œì‘
```

#### 2. Gate Close ì‹œí€€ìŠ¤
```
ì‹œê°„: T-1ms         T           T+1ms
ìƒíƒœ: [Open] â†’ [Closing] â†’ [Closed]
      ë§ˆì§€ë§‰ ì „ì†¡  ë²„í¼ ë¹„ì›€    ì™„ì „ ì°¨ë‹¨
```

### Gate Switching Latency

#### ì¸¡ì • ê²°ê³¼
```
í‰ê·  ì „í™˜ ì§€ì—°: <100ns
ìµœëŒ€ ì „í™˜ ì§€ì—°: <1Î¼s
í‘œì¤€í¸ì°¨: <50ns

ë¶„í¬:
 ë¹ˆë„
  â”‚     â•±â•²
  â”‚    â•±  â•²
  â”‚   â•±    â•²
  â”‚  â•±      â•²
  â”‚ â•±        â•²
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ì§€ì—°(ns)
   0  50 100 150
```

### Guard Band íš¨ê³¼

#### Guard Band ì—†ì´
```
ìŠ¬ë¡¯ ê²½ê³„: |TC0|TC1|
ì‹¤ì œ ì „ì†¡: |TC0â–ˆâ–ˆâ–ˆ|â–ˆTC1| â† ì˜¤ë²„ëŸ° ë°œìƒ
```

#### Guard Band ìˆì„ ë•Œ (500Î¼s)
```
ìŠ¬ë¡¯ ê²½ê³„: |TC0  |  TC1|
ì‹¤ì œ ì „ì†¡: |TC0â–ˆâ–ˆ| |TC1â–ˆ| â† ê¹¨ë—í•œ ì „í™˜
           â””â”€GBâ”€â”˜ â””â”€GBâ”€â”˜
```

---

## ì‹¤ì œ êµ¬í˜„ ë° ê²€ì¦

### CBS + TAS ë™ì‹œ ë™ì‘

#### í†µí•© ë™ì‘ ëª¨ë“œ
```
íŠ¸ë˜í”½ â†’ CBS ì²´í¬ â†’ TAS Gate ì²´í¬ â†’ ì „ì†¡

TC2 (CBS+TAS):
1. CBS: 1.5 Mbps ì œí•œ í™•ì¸
2. TAS: 80-100ms ìŠ¬ë¡¯ í™•ì¸
3. ë‘˜ ë‹¤ OK â†’ ì „ì†¡
4. í•˜ë‚˜ë¼ë„ NO â†’ ëŒ€ê¸°
```

#### ì‹¤ì œ ì¸¡ì • ê²°ê³¼
```
TC2 (CBS+TAS):
- CBS ì œí•œ: 1.5 Mbps
- TAS ìŠ¬ë¡¯: 20ms (10%)
- ì‹¤ì œ ì²˜ë¦¬ëŸ‰: 1.48 Mbps (CBSê°€ ì œí•œ)

TC0 (TAS only):
- TAS ìŠ¬ë¡¯: 50ms (25%)
- ì‹¤ì œ ì²˜ë¦¬ëŸ‰: 24.98 Mbps (ë§í¬ ì†ë„ì˜ 25%)
```

### í ë…ë¦½ì„± ê²€ì¦

#### ê°„ì„­ ë§¤íŠ¸ë¦­ìŠ¤
```
     TC0 TC1 TC2 TC3 TC4 TC5 TC6 TC7
TC0   -   0   0   0   0   0   0   0
TC1   0   -   0   0   0   0   0   0
TC2   0   0   -   0   0   0   0   0
TC3   0   0   0   -   0   0   0   0
TC4   0   0   0   0   -   0   0   0
TC5   0   0   0   0   0   -   0   0
TC6   0   0   0   0   0   0   -   0
TC7   0   0   0   0   0   0   0   -

0 = ê°„ì„­ ì—†ìŒ (100% ë…ë¦½)
```

### ì‹¤ì œ ë³´ë“œ ëª…ë ¹ì–´ ì˜ˆì‹œ

#### CBS ì„¤ì •
```bash
# PCP 0 â†’ Priority 6 ë§¤í•‘
dr mup1cc coap post /ieee802-dot1q-bridge/bridges/bridge=br0/component=0/traffic-class-table/pcp=0/priority 6

# Priority 6 â†’ TC6 ë§¤í•‘
dr mup1cc coap post /ieee802-dot1q-bridge/bridges/bridge=br0/component=0/traffic-class-table/priority=6/traffic-class 6

# TC6 CBS íŒŒë¼ë¯¸í„°
dr mup1cc coap post /ieee802-dot1q-sched/interfaces/interface=eth0/scheduler/traffic-class=6/cbs/idle-slope 3500
dr mup1cc coap post /ieee802-dot1q-sched/interfaces/interface=eth0/scheduler/traffic-class=6/cbs/enabled true
```

#### TAS ì„¤ì •
```bash
# ì‚¬ì´í´ ì‹œê°„ (200ms)
dr mup1cc coap post /ieee802-dot1q-sched/interfaces/interface=eth0/scheduler/admin-cycle-time 200000000

# TC0 ê²Œì´íŠ¸ (0-50ms)
dr mup1cc coap post /ieee802-dot1q-sched/interfaces/interface=eth0/scheduler/admin-control-list/0/time-interval 50000000
dr mup1cc coap post /ieee802-dot1q-sched/interfaces/interface=eth0/scheduler/admin-control-list/0/gate-states 0x01
```

---

## ì„±ëŠ¥ í‰ê°€ ê²°ê³¼

### CBS ì„±ëŠ¥
- **TC2**: 1.479 Mbps (ëª©í‘œ 1.5 Mbps) - 98.6% ì •í™•ë„
- **TC6**: 3.468 Mbps (ëª©í‘œ 3.5 Mbps) - 99.1% ì •í™•ë„
- **ì§€í„°**: <0.05ms
- **íŒ¨í‚· ì†ì‹¤**: <0.01%

### TAS ì„±ëŠ¥
- **Gate ì „í™˜ ì§€ì—°**: <100ns
- **Gate Violations**: <0.1%
- **ì‚¬ì´í´ ì •í™•ë„**: 99.95%
- **í ë…ë¦½ì„±**: 100%

### ì‚°ì—… ì ìš©
1. **ìë™ì°¨**: ì„¼ì„œ ë°ì´í„° + ì œì–´ ëª…ë ¹
2. **ê³µì¥ ìë™í™”**: PLC í†µì‹  + ëª¨ë‹ˆí„°ë§
3. **ë°©ì†¡**: ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°
4. **5G**: í”„ë¡ íŠ¸í™€/ë°±í™€ ë„¤íŠ¸ì›Œí¬

---

## ê²°ë¡ 

TSNì€ í‘œì¤€ ì´ë”ë„·ì— **ì‹œê°„ ê°œë…**ì„ ì¶”ê°€í•˜ì—¬ ê²°ì •ì  í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤:

1. **CBS**: Credit ì‹œìŠ¤í…œìœ¼ë¡œ ëŒ€ì—­í­ ì œì–´
2. **TAS**: Gateë¡œ ì‹œê°„ ìŠ¬ë¡¯ ì œì–´
3. **í†µí•©**: CBS+TASë¡œ ì™„ë²½í•œ QoS ë³´ì¥

ì´ë¥¼ í†µí•´ í•˜ë‚˜ì˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ í¬ë¦¬í‹°ì»¬ ì œì–´ íŠ¸ë˜í”½ê³¼ ì¼ë°˜ ë°ì´í„°ë¥¼ ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì**: ê¹€í˜„ìš°  
**ë‚ ì§œ**: 2024ë…„ 8ì›” 29ì¼  
**GitHub**: https://github.com/hwkim3330/microchip-velocitydrive-lan9662