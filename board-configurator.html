<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAN9662 VelocityDRIVE Board Configurator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
        }

        .status-indicator.connected {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .connect-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .connect-btn:hover {
            background: #0056b3;
        }

        .connect-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: black;
        }

        .cbs-calculator {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .traffic-class-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .tc-card {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .tc-card.active {
            background: #007bff;
            color: white;
        }

        .gcl-editor {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }

        .gcl-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .gcl-gates {
            display: flex;
            gap: 5px;
        }

        .gate-toggle {
            width: 30px;
            height: 30px;
            border: 2px solid #ddd;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .gate-toggle.open {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .console {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
        }

        .console-line {
            margin-bottom: 5px;
        }

        .console-line.error {
            color: #ff0000;
        }

        .console-line.info {
            color: #00ffff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }

        .preset-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset-btn {
            padding: 5px 10px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
        }

        .preset-btn.active {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸš€ LAN9662 VelocityDRIVE Board Configurator</h1>
            <div class="connection-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Disconnected</span>
                <button class="connect-btn" id="connectBtn">Connect</button>
                <select id="baudRate">
                    <option value="115200">115200</option>
                    <option value="9600">9600</option>
                    <option value="19200">19200</option>
                    <option value="38400">38400</option>
                    <option value="57600">57600</option>
                </select>
            </div>
        </div>

        <div class="main-content">
            <!-- Configuration Panel -->
            <div class="panel">
                <div class="tabs">
                    <button class="tab active" data-tab="cbs">CBS</button>
                    <button class="tab" data-tab="tas">TAS</button>
                    <button class="tab" data-tab="priority">Priority</button>
                    <button class="tab" data-tab="vlan">VLAN</button>
                    <button class="tab" data-tab="ptp">PTP</button>
                    <button class="tab" data-tab="manual">Manual</button>
                </div>

                <!-- CBS Tab -->
                <div class="tab-content active" id="cbs">
                    <h3>Credit-Based Shaper Configuration</h3>
                    
                    <div class="cbs-calculator">
                        <h4>Bandwidth Calculator</h4>
                        <div class="form-group">
                            <label>Desired Bandwidth (Mbps)</label>
                            <input type="number" id="cbsBandwidth" value="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Calculated Idle Slope</label>
                            <input type="text" id="cbsIdleSlope" readonly>
                        </div>
                    </div>

                    <div class="traffic-class-grid">
                        <div class="tc-card" data-tc="0">TC0</div>
                        <div class="tc-card" data-tc="1">TC1</div>
                        <div class="tc-card" data-tc="2">TC2</div>
                        <div class="tc-card" data-tc="3">TC3</div>
                        <div class="tc-card" data-tc="4">TC4</div>
                        <div class="tc-card" data-tc="5">TC5</div>
                        <div class="tc-card" data-tc="6">TC6</div>
                        <div class="tc-card" data-tc="7">TC7</div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="cbsApply">Apply CBS</button>
                        <button class="btn btn-danger" id="cbsDisable">Disable CBS</button>
                    </div>
                </div>

                <!-- TAS Tab -->
                <div class="tab-content" id="tas">
                    <h3>Time-Aware Shaper Configuration</h3>
                    
                    <div class="preset-selector">
                        <button class="preset-btn" data-preset="equal">Equal Slots</button>
                        <button class="preset-btn" data-preset="priority">Priority Based</button>
                        <button class="preset-btn" data-preset="custom">Custom</button>
                    </div>

                    <div class="form-group">
                        <label>Cycle Time (Î¼s)</label>
                        <input type="number" id="tasCycleTime" value="200000">
                    </div>

                    <div class="gcl-editor">
                        <h4>Gate Control List</h4>
                        <div id="gclEntries"></div>
                        <button class="btn btn-success" id="addGCLEntry">Add Entry</button>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="tasApply">Apply TAS</button>
                        <button class="btn btn-danger" id="tasDisable">Disable TAS</button>
                    </div>
                </div>

                <!-- Priority Tab -->
                <div class="tab-content" id="priority">
                    <h3>Priority Mapping</h3>
                    
                    <h4>PCP to Priority</h4>
                    <div id="pcpMapping"></div>
                    
                    <h4>Priority to Traffic Class</h4>
                    <div id="priorityMapping"></div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="priorityApply">Apply Mapping</button>
                        <button class="btn btn-warning" id="priorityReset">Reset to Default</button>
                    </div>
                </div>

                <!-- VLAN Tab -->
                <div class="tab-content" id="vlan">
                    <h3>VLAN Configuration</h3>
                    
                    <div class="form-group">
                        <label>VLAN ID</label>
                        <input type="number" id="vlanId" min="1" max="4094" value="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Ports</label>
                        <select id="vlanPorts" multiple size="4">
                            <option value="0">Port 0</option>
                            <option value="1">Port 1</option>
                            <option value="2">Port 2</option>
                            <option value="3">Port 3</option>
                        </select>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="vlanAdd">Add VLAN</button>
                        <button class="btn btn-danger" id="vlanRemove">Remove VLAN</button>
                    </div>
                </div>

                <!-- PTP Tab -->
                <div class="tab-content" id="ptp">
                    <h3>PTP/1588 Configuration</h3>
                    
                    <div class="form-group">
                        <label>Domain Number</label>
                        <input type="number" id="ptpDomain" min="0" max="255" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label>Priority 1</label>
                        <input type="number" id="ptpPriority1" min="0" max="255" value="128">
                    </div>
                    
                    <div class="form-group">
                        <label>Priority 2</label>
                        <input type="number" id="ptpPriority2" min="0" max="255" value="128">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ptpSlaveOnly"> Slave Only
                        </label>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="ptpApply">Apply PTP</button>
                        <button class="btn btn-warning" id="ptpSync">Force Sync</button>
                    </div>
                </div>

                <!-- Manual Tab -->
                <div class="tab-content" id="manual">
                    <h3>Manual Command</h3>
                    
                    <div class="form-group">
                        <label>Command Type</label>
                        <select id="cmdType">
                            <option value="get">GET</option>
                            <option value="set">SET</option>
                            <option value="delete">DELETE</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>YANG Path</label>
                        <input type="text" id="yangPath" placeholder="/ietf-interfaces:interfaces">
                    </div>
                    
                    <div class="form-group">
                        <label>Value (for SET)</label>
                        <input type="text" id="cmdValue">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="cmdExecute">Execute</button>
                        <button class="btn btn-warning" id="cmdClear">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Monitoring Panel -->
            <div class="panel">
                <h3>ðŸ“Š Real-time Statistics</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="txPackets">0</div>
                        <div class="stat-label">TX Packets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="rxPackets">0</div>
                        <div class="stat-label">RX Packets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="throughput">0</div>
                        <div class="stat-label">Throughput (Mbps)</div>
                    </div>
                </div>

                <h4 style="margin-top: 20px;">Gate Visualization</h4>
                <canvas id="gateCanvas" width="400" height="200" style="width: 100%; border: 1px solid #ddd;"></canvas>
            </div>

            <!-- Console -->
            <div class="panel full-width">
                <h3>ðŸ“Ÿ Console Output</h3>
                <div class="console" id="console"></div>
                <div class="btn-group">
                    <button class="btn btn-warning" id="clearConsole">Clear</button>
                    <button class="btn btn-success" id="exportLogs">Export Logs</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include JavaScript libraries -->
    <script src="js/webserial-core.js"></script>
    <script src="js/mvdct-commands.js"></script>
    <script>
        // Initialize
        const serial = new WebSerialCore();
        const mvdct = new MvdctCommands();
        let selectedTC = null;
        let gclEntries = [];
        let statsInterval = null;

        // Console logging
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            const timestamp = new Date().toTimeString().split(' ')[0];
            line.textContent = `[${timestamp}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        // Connection management
        document.getElementById('connectBtn').addEventListener('click', async () => {
            const btn = document.getElementById('connectBtn');
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (serial.isConnected()) {
                // Disconnect
                await serial.disconnect();
                btn.textContent = 'Connect';
                statusIndicator.classList.remove('connected');
                statusText.textContent = 'Disconnected';
                clearInterval(statsInterval);
                log('Disconnected from device');
            } else {
                // Connect
                try {
                    const baudRate = parseInt(document.getElementById('baudRate').value);
                    await serial.connect(baudRate);
                    btn.textContent = 'Disconnect';
                    statusIndicator.classList.add('connected');
                    statusText.textContent = 'Connected';
                    log('Connected to device');
                    
                    // Start monitoring
                    startMonitoring();
                } catch (error) {
                    log(`Connection failed: ${error.message}`, 'error');
                }
            }
        });

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // CBS Configuration
        document.getElementById('cbsBandwidth').addEventListener('input', (e) => {
            const bandwidth = parseFloat(e.target.value);
            const idleSlope = Math.round(bandwidth * 1000); // Convert Mbps to kbps
            document.getElementById('cbsIdleSlope').value = idleSlope;
        });

        document.querySelectorAll('.tc-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.tc-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                selectedTC = card.dataset.tc;
            });
        });

        document.getElementById('cbsApply').addEventListener('click', async () => {
            if (!serial.isConnected()) {
                log('Not connected to device', 'error');
                return;
            }
            
            if (selectedTC === null) {
                log('Please select a traffic class', 'error');
                return;
            }
            
            const idleSlope = document.getElementById('cbsIdleSlope').value;
            const commands = mvdct.buildCBSCommands(selectedTC, idleSlope);
            
            for (const cmd of commands) {
                try {
                    const response = await serial.sendCommand(cmd);
                    log(`CBS TC${selectedTC}: ${response}`);
                } catch (error) {
                    log(`CBS configuration failed: ${error.message}`, 'error');
                }
            }
        });

        // TAS Configuration
        function createGCLEntry() {
            const entry = document.createElement('div');
            entry.className = 'gcl-entry';
            entry.innerHTML = `
                <span>Entry ${gclEntries.length}:</span>
                <input type="number" class="gcl-duration" value="25000" placeholder="Duration (ns)">
                <div class="gcl-gates">
                    ${[0,1,2,3,4,5,6,7].map(i => `
                        <button class="gate-toggle" data-gate="${i}">${i}</button>
                    `).join('')}
                </div>
                <button class="btn btn-danger" onclick="removeGCLEntry(this)">Remove</button>
            `;
            
            // Gate toggle functionality
            entry.querySelectorAll('.gate-toggle').forEach(gate => {
                gate.addEventListener('click', () => {
                    gate.classList.toggle('open');
                });
            });
            
            return entry;
        }

        document.getElementById('addGCLEntry').addEventListener('click', () => {
            const container = document.getElementById('gclEntries');
            container.appendChild(createGCLEntry());
        });

        function removeGCLEntry(btn) {
            btn.parentElement.remove();
        }

        document.getElementById('tasApply').addEventListener('click', async () => {
            if (!serial.isConnected()) {
                log('Not connected to device', 'error');
                return;
            }
            
            const cycleTime = document.getElementById('tasCycleTime').value;
            const baseTime = Date.now() * 1000000; // Current time in nanoseconds
            
            // Collect GCL entries
            const gclList = [];
            document.querySelectorAll('.gcl-entry').forEach(entry => {
                const duration = entry.querySelector('.gcl-duration').value;
                let gateStates = 0;
                entry.querySelectorAll('.gate-toggle.open').forEach(gate => {
                    gateStates |= (1 << parseInt(gate.dataset.gate));
                });
                gclList.push({ timeInterval: duration, gateStates: gateStates });
            });
            
            if (gclList.length === 0) {
                log('Please add at least one GCL entry', 'error');
                return;
            }
            
            const commands = mvdct.buildTASCommands(gclList, cycleTime, baseTime);
            
            for (const cmd of commands) {
                try {
                    const response = await serial.sendCommand(cmd);
                    log(`TAS: ${response}`);
                } catch (error) {
                    log(`TAS configuration failed: ${error.message}`, 'error');
                }
            }
        });

        // Priority Mapping
        function initPriorityMapping() {
            const pcpContainer = document.getElementById('pcpMapping');
            const priorityContainer = document.getElementById('priorityMapping');
            
            // PCP to Priority mapping
            for (let pcp = 0; pcp < 8; pcp++) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>PCP ${pcp} â†’ Priority</label>
                    <select class="pcp-priority" data-pcp="${pcp}">
                        ${[0,1,2,3,4,5,6,7].map(p => 
                            `<option value="${p}" ${p === pcp ? 'selected' : ''}>${p}</option>`
                        ).join('')}
                    </select>
                `;
                pcpContainer.appendChild(div);
            }
            
            // Priority to TC mapping
            for (let priority = 0; priority < 8; priority++) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>Priority ${priority} â†’ TC</label>
                    <select class="priority-tc" data-priority="${priority}">
                        ${[0,1,2,3,4,5,6,7].map(tc => 
                            `<option value="${tc}" ${tc === priority ? 'selected' : ''}>${tc}</option>`
                        ).join('')}
                    </select>
                `;
                priorityContainer.appendChild(div);
            }
        }

        document.getElementById('priorityApply').addEventListener('click', async () => {
            if (!serial.isConnected()) {
                log('Not connected to device', 'error');
                return;
            }
            
            const mappings = [];
            
            // Collect PCP to Priority mappings
            document.querySelectorAll('.pcp-priority').forEach(select => {
                const pcp = parseInt(select.dataset.pcp);
                const priority = parseInt(select.value);
                mappings.push({ pcp, priority });
            });
            
            // Collect Priority to TC mappings
            document.querySelectorAll('.priority-tc').forEach(select => {
                const priority = parseInt(select.dataset.priority);
                const trafficClass = parseInt(select.value);
                const existing = mappings.find(m => m.priority === priority);
                if (existing) {
                    existing.trafficClass = trafficClass;
                } else {
                    mappings.push({ priority, trafficClass });
                }
            });
            
            const commands = mvdct.buildPriorityMappingCommands(mappings);
            
            for (const cmd of commands) {
                try {
                    const response = await serial.sendCommand(cmd);
                    log(`Priority mapping: ${response}`);
                } catch (error) {
                    log(`Priority mapping failed: ${error.message}`, 'error');
                }
            }
        });

        // Manual command execution
        document.getElementById('cmdExecute').addEventListener('click', async () => {
            if (!serial.isConnected()) {
                log('Not connected to device', 'error');
                return;
            }
            
            const type = document.getElementById('cmdType').value;
            const yangPath = document.getElementById('yangPath').value;
            const value = document.getElementById('cmdValue').value;
            
            let command;
            switch (type) {
                case 'get':
                    command = mvdct.buildGetCommand(yangPath);
                    break;
                case 'set':
                    command = mvdct.buildSetCommand(yangPath, value);
                    break;
                case 'delete':
                    command = mvdct.buildDeleteCommand(yangPath);
                    break;
            }
            
            try {
                const response = await serial.sendCommand(command);
                log(`Manual command: ${response}`);
            } catch (error) {
                log(`Command failed: ${error.message}`, 'error');
            }
        });

        // Console operations
        document.getElementById('clearConsole').addEventListener('click', () => {
            document.getElementById('console').innerHTML = '';
        });

        document.getElementById('exportLogs').addEventListener('click', () => {
            const logs = Array.from(document.querySelectorAll('.console-line'))
                .map(line => line.textContent)
                .join('\n');
            
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lan9662_logs_${new Date().toISOString()}.txt`;
            a.click();
        });

        // Statistics monitoring
        async function updateStatistics() {
            if (!serial.isConnected()) return;
            
            try {
                const response = await serial.sendCommand(
                    mvdct.buildGetCommand(mvdct.yangPaths.interfaces.stats)
                );
                
                const stats = mvdct.parseStatistics(response);
                
                document.getElementById('txPackets').textContent = 
                    stats['out-unicast-pkts'] || 0;
                document.getElementById('rxPackets').textContent = 
                    stats['in-unicast-pkts'] || 0;
                
                // Calculate throughput (simplified)
                const totalBytes = (stats['in-octets'] || 0) + (stats['out-octets'] || 0);
                const throughput = (totalBytes * 8 / 1000000).toFixed(2); // Mbps
                document.getElementById('throughput').textContent = throughput;
                
            } catch (error) {
                console.error('Statistics update failed:', error);
            }
        }

        function startMonitoring() {
            updateStatistics();
            statsInterval = setInterval(updateStatistics, 2000);
        }

        // Gate visualization
        function drawGateVisualization() {
            const canvas = document.getElementById('gateCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 8; i++) {
                const y = (canvas.height / 8) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw gate states (example)
            const gateStates = [1, 0, 1, 1, 0, 1, 0, 1]; // Example states
            const gateWidth = canvas.width / 10;
            
            for (let tc = 0; tc < 8; tc++) {
                for (let slot = 0; slot < 10; slot++) {
                    const x = slot * gateWidth;
                    const y = tc * (canvas.height / 8);
                    
                    if ((slot % 2) === gateStates[tc]) {
                        ctx.fillStyle = '#28a745';
                    } else {
                        ctx.fillStyle = '#dc3545';
                    }
                    
                    ctx.fillRect(x, y, gateWidth - 2, (canvas.height / 8) - 2);
                }
            }
        }

        // Initialize
        initPriorityMapping();
        drawGateVisualization();
        
        // Add initial GCL entries
        for (let i = 0; i < 4; i++) {
            document.getElementById('addGCLEntry').click();
        }
        
        log('Board Configurator initialized');
    </script>
</body>
</html>